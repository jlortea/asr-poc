{
  "id": null,
  "uid": null,
  "title": "Deitu – STT Overview (Deepgram + TAP + MTI)",
  "tags": ["deitu", "voicebot", "deepgram", "telephony"],
  "timezone": "browser",
  "schemaVersion": 39,
  "version": 1,
  "refresh": "10s",
  "style": "dark",
  "panels": [
    {
      "type": "row",
      "title": "High level",
      "collapsed": false,
      "gridPos": { "x": 0, "y": 0, "w": 24, "h": 1 },
      "id": 1
    },
    {
      "id": 2,
      "type": "stat",
      "title": "Deepgram – Active sessions",
      "gridPos": { "x": 0, "y": 1, "w": 6, "h": 4 },
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS_DS"
      },
      "targets": [
        {
          "expr": "dg_sessions_active",
          "legendFormat": "sessions",
          "refId": "A"
        }
      ],
      "options": {
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
        "orientation": "auto",
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "center"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "none",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "green", "value": null },
              { "color": "orange", "value": 3 },
              { "color": "red", "value": 5 }
            ]
          }
        },
        "overrides": []
      }
    },
    {
      "id": 3,
      "type": "stat",
      "title": "TAP – Active sessions (snoop)",
      "gridPos": { "x": 6, "y": 1, "w": 6, "h": 4 },
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS_DS"
      },
      "targets": [
        {
          "expr": "tap_sessions_active",
          "legendFormat": "sessions",
          "refId": "A"
        }
      ],
      "options": {
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
        "orientation": "auto",
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "center"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "none",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "green", "value": null },
              { "color": "orange", "value": 3 },
              { "color": "red", "value": 5 }
            ]
          }
        },
        "overrides": []
      }
    },
    {
      "id": 4,
      "type": "stat",
      "title": "MTI – Active sessions",
      "gridPos": { "x": 12, "y": 1, "w": 6, "h": 4 },
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS_DS"
      },
      "targets": [
        {
          "expr": "mti_sessions_active",
          "legendFormat": "sessions",
          "refId": "A"
        }
      ],
      "options": {
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
        "orientation": "auto",
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "center"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "none",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "green", "value": null },
              { "color": "orange", "value": 3 },
              { "color": "red", "value": 5 }
            ]
          }
        },
        "overrides": []
      }
    },
    {
      "id": 5,
      "type": "stat",
      "title": "Global health – STT stack",
      "gridPos": { "x": 18, "y": 1, "w": 6, "h": 4 },
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS_DS"
      },
      "targets": [
        {
          "expr": "min(up{job=~\"deepgram-gw|tap-service|mti-gw\"})",
          "legendFormat": "min up()",
          "refId": "A"
        }
      ],
      "options": {
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
        "orientation": "auto",
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "center",
        "textMode": "value"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "none",
          "mappings": [
            { "type": "value", "options": { "0": { "index": 0, "text": "DOWN" } } },
            { "type": "value", "options": { "1": { "index": 1, "text": "OK" } } }
          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "red", "value": null },
              { "color": "green", "value": 1 }
            ]
          }
        },
        "overrides": []
      }
    },

    {
      "type": "row",
      "title": "Deepgram gateway",
      "collapsed": false,
      "gridPos": { "x": 0, "y": 5, "w": 24, "h": 1 },
      "id": 10
    },
    {
      "id": 11,
      "type": "timeseries",
      "title": "Deepgram – RTP packets per second (by dir)",
      "gridPos": { "x": 0, "y": 6, "w": 16, "h": 7 },
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS_DS"
      },
      "targets": [
        {
          "expr": "rate(dg_rtp_packets_total[30s])",
          "legendFormat": "{{dir}}",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "pps",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "red", "value": 0 },
              { "color": "green", "value": 1 }
            ]
          }
        },
        "overrides": []
      },
      "options": {
        "legend": { "displayMode": "table", "placement": "bottom" },
        "tooltip": { "mode": "single" }
      }
    },
    {
      "id": 12,
      "type": "stat",
      "title": "WS reconnects (5m)",
      "gridPos": { "x": 16, "y": 6, "w": 4, "h": 4 },
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS_DS"
      },
      "targets": [
        {
          "expr": "increase(dg_ws_reconnects_total[5m])",
          "legendFormat": "reconnects",
          "refId": "A"
        }
      ],
      "options": {
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
        "orientation": "auto",
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "center"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "none",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "green", "value": null },
              { "color": "orange", "value": 1 },
              { "color": "red", "value": 3 }
            ]
          }
        },
        "overrides": []
      }
    },
    {
      "id": 13,
      "type": "stat",
      "title": "Deepgram – Sessions (now)",
      "gridPos": { "x": 20, "y": 6, "w": 4, "h": 4 },
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS_DS"
      },
      "targets": [
        {
          "expr": "dg_sessions_active",
          "legendFormat": "sessions",
          "refId": "A"
        }
      ],
      "options": {
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
        "orientation": "auto",
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "center"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "none",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "green", "value": null },
              { "color": "orange", "value": 3 },
              { "color": "red", "value": 5 }
            ]
          }
        },
        "overrides": []
      }
    },

    {
      "type": "row",
      "title": "TAP-service",
      "collapsed": false,
      "gridPos": { "x": 0, "y": 13, "w": 24, "h": 1 },
      "id": 20
    },
    {
      "id": 21,
      "type": "timeseries",
      "title": "TAP – active channels (snoop vs externalMedia)",
      "gridPos": { "x": 0, "y": 14, "w": 12, "h": 7 },
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS_DS"
      },
      "targets": [
        {
          "expr": "tap_snoop_active",
          "legendFormat": "snoop",
          "refId": "A"
        },
        {
          "expr": "tap_externalmedia_active",
          "legendFormat": "externalMedia",
          "refId": "B"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "none"
        },
        "overrides": []
      },
      "options": {
        "legend": { "displayMode": "table", "placement": "bottom" },
        "tooltip": { "mode": "single" }
      }
    },
    {
      "id": 22,
      "type": "timeseries",
      "title": "TAP – cleanup events (rate)",
      "gridPos": { "x": 12, "y": 14, "w": 12, "h": 7 },
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS_DS"
      },
      "targets": [
        {
          "expr": "rate(tap_cleanup_total[5m])",
          "legendFormat": "cleanup /s",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "ops",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "green", "value": null },
              { "color": "orange", "value": 0.1 },
              { "color": "red", "value": 1 }
            ]
          }
        },
        "overrides": []
      },
      "options": {
        "legend": { "displayMode": "table", "placement": "bottom" },
        "tooltip": { "mode": "single" }
      }
    },

    {
      "type": "row",
      "title": "MTI gateway",
      "collapsed": false,
      "gridPos": { "x": 0, "y": 21, "w": 24, "h": 1 },
      "id": 30
    },
    {
      "id": 31,
      "type": "timeseries",
      "title": "MTI – RTP packets per second",
      "gridPos": { "x": 0, "y": 22, "w": 12, "h": 7 },
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS_DS"
      },
      "targets": [
        {
          "expr": "rate(mti_rtp_packets_total[30s])",
          "legendFormat": "rtp pps",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "pps"
        },
        "overrides": []
      },
      "options": {
        "legend": { "displayMode": "table", "placement": "bottom" },
        "tooltip": { "mode": "single" }
      }
    },
    {
      "id": 32,
      "type": "stat",
      "title": "MTI inactivity timeouts (5m)",
      "gridPos": { "x": 12, "y": 22, "w": 6, "h": 4 },
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS_DS"
      },
      "targets": [
        {
          "expr": "increase(mti_inactivity_total[5m])",
          "legendFormat": "timeouts",
          "refId": "A"
        }
      ],
      "options": {
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
        "orientation": "auto",
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "center"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "none",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "green", "value": null },
              { "color": "orange", "value": 1 },
              { "color": "red", "value": 3 }
            ]
          }
        },
        "overrides": []
      }
    },
    {
      "id": 33,
      "type": "stat",
      "title": "MTI TCP errors (5m)",
      "gridPos": { "x": 18, "y": 22, "w": 6, "h": 4 },
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS_DS"
      },
      "targets": [
        {
          "expr": "increase(mti_tcp_errors_total[5m])",
          "legendFormat": "tcp errors",
          "refId": "A"
        }
      ],
      "options": {
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
        "orientation": "auto",
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "center"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "none",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "green", "value": null },
              { "color": "orange", "value": 1 },
              { "color": "red", "value": 3 }
            ]
          }
        },
        "overrides": []
      }
    }
  ],
  "time": {
    "from": "now-15m",
    "to": "now"
  },
  "timepicker": {
    "refresh_intervals": ["5s", "10s", "30s", "1m", "5m", "15m", "30m", "1h"],
    "time_options": ["5m", "15m", "1h", "6h", "12h", "24h"]
  }
}
